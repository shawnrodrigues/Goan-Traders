---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const RECAPTCHA_SITE_KEY = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY;
---

<Layout 
  title="Contact Goan Traders - Cement Supplier & Building Materials Dealer in Goa" 
  description="Contact Goan Traders for cement, sand and building materials in Goa. Call +91-9765664489, WhatsApp or visit our store. Fast delivery across Goa with competitive prices."
  keywords="contact Goan Traders, cement supplier phone number, building materials goa contact, jk cement dealer contact, cement delivery goa, construction materials contact"
>
  {RECAPTCHA_SITE_KEY && (
    <script src={`https://www.google.com/recaptcha/api.js?render=${RECAPTCHA_SITE_KEY}`} defer></script>
  )}
  <Header />
  <main>
    <section class="contact-hero">
      <div class="container">
        <div class="hero-content">
          <h1>Contact Goan Traders</h1>
          <p>Get in touch for the best cement and building material prices in Goa</p>
          <div class="hero-features">
            <div class="feature">
              <span class="feature-icon">âš¡</span>
              <span>24-Hour Response</span>
            </div>
            <div class="feature">
              <span class="feature-icon">ðŸ“ž</span>
              <span>Free Consultation</span>
            </div>
            <div class="feature">
              <span class="feature-icon">ðŸšš</span>
              <span>Same-Day Delivery</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Quick Contact Bar -->
    <section class="quick-contact-bar">
      <div class="container">
        <div class="quick-contact-content">
          <div class="quick-contact-text">
            <h3>Need Immediate Assistance?</h3>
            <p>Call now for instant quotes and availability</p>
          </div>
          <div class="quick-contact-actions">
            <a href="tel:+919765664489" class="quick-btn call">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
              </svg>
              Call Now
            </a>
            <a href="https://wa.me/919765664489" class="quick-btn whatsapp">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106"/>
              </svg>
              WhatsApp
            </a>
          </div>
        </div>
      </div>
    </section>
    
    <section class="contact-info-section">
      <div class="container">
        <div class="contact-grid">
          <div class="contact-methods">
            <h2>Get In Touch</h2>
            <p>Ready to start your construction project? Contact us today for competitive quotes and fast delivery across Goa.</p>
            
            <div class="contact-cards">
                <div class="contact-card">
                  <div class="contact-icon"><svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg></div>
                  <h3>Call Us</h3>
                  <p>Speak directly with our team</p>
                  <a href="tel:+919765664489" class="btn btn-primary">+91-9765664489</a>
                </div>
                <div class="contact-card">
                  <div class="contact-icon"><svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106"/></svg></div>
                  <h3>WhatsApp</h3>
                  <p>Quick chat for instant quotes</p>
                  <a href="https://wa.me/919765664489" class="btn btn-success">Message Us</a>
                </div>
                <div class="contact-card">
                  <div class="contact-icon"><svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></div>
                  <h3>Visit Our Store</h3>
                  <p>See our products in person</p>
                  <span class="location-text">Serving All of Goa</span>
                </div>
              </div>
            
            <div class="business-hours">
              <h3>Business Hours</h3>
              <div class="hours-grid">
                <div class="hours-item"><span class="day">Monday - Saturday</span><span class="time">8:00 AM - 6:00 PM</span></div>
                <div class="hours-item"><span class="day">Sunday</span><span class="time">8:00 AM - 1:00 PM</span></div>
              </div>
            </div>
          </div>
          
          <div class="contact-form-section">
            <div class="form-container">
              <h2>Send Us a Message</h2>
              <p>Fill out the form below and we'll get back to you within 24 hours with a competitive quote.</p>
              
              <form class="contact-form" id="contact-form">
                <!-- Error/Success Message Display -->
                <div id="form-message" class="form-message" style="display: none;"></div>
                <input type="hidden" name="recaptchaToken" id="recaptchaToken" />
                
                <div class="form-group"><label for="name">Full Name *</label><input type="text" id="name" name="name" required></div>
                <div class="form-group"><label for="phone">Phone Number *</label><input type="tel" id="phone" name="phone" required></div>
                <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" name="email"></div>
                <div class="form-group"><label for="location">Project Location in Goa</label><input type="text" id="location" name="location" placeholder="e.g., Panjim, Margao, Mapusa"></div>
                <div class="form-group"><label for="products">Products Needed</label><select id="products" name="products"><option value="">Select Product Category</option><option value="jk-cement">JK Cement</option><option value="jsw-cement">JSW Cement</option><option value="ultratech">Ultratech Cement</option><option value="ramco">Ramco Cement</option><option value="sand">River Sand</option><option value="multiple">Multiple Products</option><option value="other">Other</option></select></div>
                <div class="form-group"><label for="quantity">Estimated Quantity</label><input type="text" id="quantity" name="quantity" placeholder="e.g., 50 bags, 10 tons"></div>
                <div class="form-group"><label for="message">Additional Details</label><textarea id="message" name="message" rows="4" placeholder="Tell us about your project requirements, delivery timeline, or any specific questions..."></textarea></div>
                <button type="submit" class="btn btn-primary btn-large" id="submit-button"><svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/></svg> Send Message</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- FAQ Section -->
    <section class="faq-section">
      <div class="container">
        <h2 class="section-title">Frequently Asked Questions</h2>
        <div class="faq-grid">
          <div class="faq-item">
            <div class="faq-question">
              <h3>What are your delivery charges?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>Delivery charges vary based on location and quantity. We offer free delivery for orders above certain quantities. Contact us for exact delivery costs to your location.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <div class="faq-question">
              <h3>Do you provide same-day delivery?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>Yes, we provide same-day delivery across most areas in Goa for orders placed before 2 PM, subject to stock availability and delivery location.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <div class="faq-question">
              <h3>What payment methods do you accept?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>We accept cash, bank transfers, UPI payments, and checks. For large orders, we also offer credit terms for established customers.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <div class="faq-question">
              <h3>Can I get technical consultation for my project?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>Absolutely! Our experienced team provides free technical consultation to help you choose the right materials for your specific construction requirements.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <div class="faq-question">
              <h3>Do you offer bulk order discounts?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>Yes, we offer attractive discounts for bulk orders. The discount rate depends on the quantity and product type. Contact us with your requirements for a custom quote.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <div class="faq-question">
              <h3>How can I check product availability?</h3>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              <p>You can call us, WhatsApp, or use our contact form to check real-time stock availability. We maintain good inventory levels of all major products.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section class="map-section">
      <div class="container">
        <h2 class="section-title">Find Us on Map</h2>
        <p class="map-description">Centrally located to serve all areas of Goa with fast delivery</p>
        <div class="map-container">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3848.283467899955!2d73.94844467580592!3d15.306822559395288!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bbfb10ba83a1c5f%3A0x21e64848edb5c76a!2sGoan%20Traders!5e0!3m2!1sen!2sin!4v1754567909279!5m2!1sen!2sinun" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Goan Traders Location - Cement and Building Materials Supplier in Goa"></iframe>
        </div>
        <div class="delivery-areas">
          <h3>Delivery Areas</h3>
          <p>We provide fast delivery to all major areas in Goa including:</p>
          <div class="areas-grid">
            <span class="area">Panjim</span><span class="area">Margao</span><span class="area">Mapusa</span><span class="area">Vasco da Gama</span><span class="area">Ponda</span><span class="area">Bicholim</span><span class="area">Curchorem</span><span class="area">Pernem</span><span class="area">Quepem</span><span class="area">Sanguem</span><span class="area">Canacona</span><span class="area">Dharbandora</span>
          </div>
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<style>
  /* Your entire UI CSS is here and remains unchanged */
  .contact-hero{background:linear-gradient(135deg,#1E40AF 0%,#3B82F6 100%);color:white;padding:6rem 0 4rem;text-align:center;position:relative;overflow:hidden}.contact-hero::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');pointer-events:none}.hero-content h1{font-size:3rem;font-weight:700;margin-bottom:1rem;text-shadow:0 2px 4px rgba(0,0,0,.3)}.hero-content p{font-size:1.25rem;opacity:.95;max-width:600px;margin:0 auto}.hero-features{display:flex;justify-content:center;gap:2rem;margin-top:2rem;flex-wrap:wrap}.feature{display:flex;align-items:center;gap:0.5rem;background:rgba(255,255,255,0.1);padding:0.75rem 1.5rem;border-radius:25px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}.feature-icon{font-size:1.2rem}.feature span:last-child{font-weight:500}.quick-contact-bar{background:white;padding:1.5rem 0;border-bottom:1px solid #F1F5F9;box-shadow:0 2px 8px rgba(0,0,0,0.05)}.quick-contact-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.quick-contact-text h3{font-size:1.25rem;font-weight:600;color:#1E293B;margin-bottom:0.25rem}.quick-contact-text p{color:#64748B;margin:0}.quick-contact-actions{display:flex;gap:1rem}.quick-btn{display:flex;align-items:center;gap:0.5rem;padding:0.75rem 1.5rem;border-radius:8px;font-weight:600;text-decoration:none;transition:all 0.3s ease}.quick-btn.call{background:#2563EB;color:white}.quick-btn.call:hover{background:#1D4ED8;transform:translateY(-1px)}.quick-btn.whatsapp{background:#10B981;color:white}.quick-btn.whatsapp:hover{background:#059669;transform:translateY(-1px)}.faq-section{padding:5rem 0;background:white}.faq-grid{display:grid;gap:1rem;max-width:800px;margin:0 auto}.faq-item{background:white;border:2px solid #F1F5F9;border-radius:12px;overflow:hidden;transition:all 0.3s ease}.faq-item:hover{border-color:#E2E8F0}.faq-question{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;cursor:pointer;background:linear-gradient(135deg,#F8FAFC 0%,#F1F5F9 100%)}.faq-question h3{font-size:1.1rem;font-weight:600;color:#1E293B;margin:0}.faq-toggle{font-size:1.5rem;font-weight:700;color:#2563EB;transition:transform 0.3s ease}.faq-item.active .faq-toggle{transform:rotate(45deg)}.faq-answer{padding:0 1.5rem;max-height:0;overflow:hidden;transition:all 0.3s ease}.faq-item.active .faq-answer{padding:0 1.5rem 1.5rem;max-height:200px}.faq-answer p{color:#64748B;line-height:1.6;margin:0}.contact-info-section{padding:5rem 0;background:white}.contact-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;align-items:start}.contact-methods h2{font-size:2.5rem;font-weight:700;color:#1E293B;margin-bottom:1rem}.contact-methods>p{font-size:1.1rem;color:#64748B;margin-bottom:3rem;line-height:1.6}.contact-cards{display:grid;gap:1.5rem;margin-bottom:3rem}.contact-card{background:linear-gradient(135deg,#F8FAFC 0%,#F1F5F9 100%);padding:2rem;border-radius:16px;text-align:center;border:1px solid #E2E8F0;transition:all .3s ease}.contact-card:hover{transform:translateY(-4px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#2563EB}.contact-icon{color:#2563EB;margin-bottom:1rem}.contact-card h3{font-size:1.25rem;font-weight:600;color:#1E293B;margin-bottom:.5rem}.contact-card p{color:#64748B;margin-bottom:1.5rem}.location-text{color:#2563EB;font-weight:500}.business-hours{background:white;padding:2rem;border-radius:16px;border:2px solid #F1F5F9}.business-hours h3{font-size:1.5rem;font-weight:600;color:#1E293B;margin-bottom:1.5rem;text-align:center}.hours-grid{display:grid;gap:1rem}.hours-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid #F1F5F9}.hours-item:last-child{border-bottom:none}.day{font-weight:500;color:#1E293B}.time{color:#2563EB;font-weight:500}.form-container{background:white;padding:3rem;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.1);border:1px solid #F1F5F9}.form-container h2{font-size:2rem;font-weight:700;color:#1E293B;margin-bottom:1rem}.form-container>p{color:#64748B;margin-bottom:2rem;line-height:1.6}  .contact-form{display:grid;gap:1.5rem}
  
  /* Form Message Styles */
  .form-message {
    padding: 1rem 1.5rem;
    border-radius: 8px;
    font-weight: 500;
    text-align: center;
    margin-bottom: 1rem;
    animation: slideIn 0.3s ease-out;
  }
  
  .form-message.error {
    background: #FEF2F2;
    border: 2px solid #FECACA;
    color: #DC2626;
  }
  
  .form-message.success {
    background: #F0FDF4;
    border: 2px solid #BBF7D0;
    color: #16A34A;
  }
  
  .form-message.info {
    background: #EFF6FF;
    border: 2px solid #BFDBFE;
    color: #2563EB;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .form-group{display:flex;flex-direction:column}.form-group label{font-weight:500;color:#1E293B;margin-bottom:.5rem}.form-group input,.form-group select,.form-group textarea{padding:12px 16px;border:2px solid #E2E8F0;border-radius:8px;font-size:16px;transition:all .3s ease;background:white}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#2563EB;box-shadow:0 0 0 3px rgba(37,99,235,.1)}.form-group textarea{resize:vertical;min-height:100px}.btn-large{padding:16px 32px;font-size:18px;font-weight:600;justify-self:start}.map-section{padding:5rem 0;background:linear-gradient(135deg,#F8FAFC 0%,#F1F5F9 100%)}.map-description{text-align:center;font-size:1.1rem;color:#64748B;margin-bottom:3rem;max-width:600px;margin-left:auto;margin-right:auto}.map-container{border-radius:16px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.1);margin-bottom:3rem}.delivery-areas{text-align:center;background:white;padding:3rem;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.05)}.delivery-areas h3{font-size:1.5rem;font-weight:600;color:#1E293B;margin-bottom:1rem}.delivery-areas>p{color:#64748B;margin-bottom:2rem}.areas-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}.area{background:#EFF6FF;color:#1D4ED8;padding:.75rem 1rem;border-radius:8px;font-weight:500;font-size:.9rem}@media (max-width:768px){.hero-content h1{font-size:2rem}.hero-features{gap:1rem}.feature{padding:0.5rem 1rem;font-size:0.9rem}.quick-contact-content{flex-direction:column;text-align:center;gap:1rem}.quick-contact-actions{justify-content:center}.quick-btn{padding:0.75rem 2rem}.contact-grid{grid-template-columns:1fr;gap:2rem}.contact-methods h2{font-size:2rem}.form-container{padding:2rem}.form-container h2{font-size:1.5rem}.areas-grid{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}.btn-large{width:100%;justify-self:stretch}}
  /* Additional styles for the success notification */
  .form-notification{position:fixed;top:20px;right:20px;background:#059669;color:white;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:1000;animation:slideIn .3s ease;font-weight:500}.form-notification.slide-out{animation:slideOut .3s ease forwards}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
</style>

<script is:inline data-sitekey={RECAPTCHA_SITE_KEY || ''}>
  const recaptchaSiteKey = document.currentScript?.dataset.sitekey || '';
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
  const formMessage = document.getElementById('form-message') as HTMLDivElement;
  const recaptchaInput = document.getElementById('recaptchaToken') as HTMLInputElement;

  function showMessage(message: string, type: 'error' | 'success' | 'info') {
    if (formMessage) {
      formMessage.textContent = message;
      formMessage.className = `form-message ${type}`;
      formMessage.style.display = 'block';
      
      // Auto-hide after 5 seconds for success/info messages
      if (type !== 'error') {
        setTimeout(() => {
          formMessage.style.display = 'none';
        }, 5000);
      }
    }
  }

  function setLoading(loading: boolean) {
    if (submitButton) {
      submitButton.disabled = loading;
      submitButton.textContent = loading ? 'Sending...' : 'Send Message';
    }
  }

  function getRecaptchaToken(): Promise<string> {
    return new Promise((resolve, reject) => {
      if (!recaptchaSiteKey) {
        reject(new Error('reCAPTCHA site key is not configured'));
        return;
      }

      const recaptcha = (window as any).grecaptcha;

      if (!recaptcha) {
        reject(new Error('reCAPTCHA script not loaded'));
        return;
      }

      recaptcha.ready(() => {
        recaptcha.execute(recaptchaSiteKey, { action: 'contact_form' })
          .then((token: string) => resolve(token))
          .catch((error: unknown) => reject(error));
      });
    });
  }

  if (form) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      if (!recaptchaSiteKey) {
        showMessage('Security check unavailable. Please try again later.', 'error');
        return;
      }
      
      // Hide any previous messages
      if (formMessage) {
        formMessage.style.display = 'none';
      }
      
      setLoading(true);

      try {
        const token = await getRecaptchaToken();
        if (recaptchaInput) {
          recaptchaInput.value = token;
        }
      } catch (recaptchaError) {
        console.error('reCAPTCHA error:', recaptchaError);
        showMessage('Security verification failed. Please refresh and try again.', 'error');
        setLoading(false);
        return;
      }

      const formData = new FormData(form);

      try {
        // Send to API for validation and Discord logging
        const response = await fetch('/api/submit-form', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();

        if (!response.ok) {
          // Show validation error to user
          showMessage(result.error || 'Please check your information and try again.', 'error');
          setLoading(false);
          return;
        }

        // If validation passed, proceed with WhatsApp redirect
        showMessage('Form validated! Redirecting to WhatsApp...', 'success');
        
        const data = Object.fromEntries(formData);
        const message = `*New Enquiry from Website*

*Name:* ${data.name}
*Phone:* ${data.phone}
*Email:* ${data.email || 'N/A'}
*Location:* ${data.location || 'N/A'}
*Products:* ${data.products || 'N/A'}
*Quantity:* ${data.quantity || 'N/A'}

*Details:*
${data.message || 'No additional details'}`;
        const encodedMessage = encodeURIComponent(message);
        const whatsappUrl = `https://wa.me/919765664489?text=${encodedMessage}`;
        
        // Open WhatsApp after a short delay
        setTimeout(() => {
          window.open(whatsappUrl, '_blank');
          form.reset();
          showMessage('Opened WhatsApp! Please send your message there.', 'info');
        }, 1500);

      } catch (error) {
        console.error('Form submission error:', error);
        showMessage('Network error. Please check your connection and try again.', 'error');
      } finally {
        setLoading(false);
      }
    });
  }

  // FAQ functionality
  document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');
    
    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question');
      
      if (question) {
        question.addEventListener('click', () => {
          const isActive = item.classList.contains('active');
          
          // Close all other FAQ items
          faqItems.forEach(otherItem => {
            if (otherItem !== item) {
              otherItem.classList.remove('active');
            }
          });
          
          // Toggle current item
          if (isActive) {
            item.classList.remove('active');
          } else {
            item.classList.add('active');
          }
        });
      }
    });
  });
</script>
